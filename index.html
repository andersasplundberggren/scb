<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Karlskoga ‚Äì folkm√§ngd (SCB via proxy)</title>
  <meta name="theme-color" content="#0B1220"/>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext y='14' font-size='14'%3Eüìä%3C/text%3E%3C/svg%3E">
  <style>
    :root { color-scheme: light dark; }
    * { box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 2rem; background: #f6f7fb; }
    .card { max-width: 760px; margin: 0 auto; padding: 1.25rem 1.5rem; border: 1px solid rgba(0,0,0,.12); border-radius: 14px; background: #fff; }
    h1 { margin: 0 0 .5rem 0; font-size: clamp(1.4rem, 3vw, 1.8rem); }
    .value { font-size: clamp(2rem, 7vw, 3.4rem); font-weight: 800; margin: .25rem 0 .5rem; letter-spacing: .02em; }
    .meta { color: #666; font-size: .95rem; }
    .small { font-size: .9rem; }
    .error { color: #b00020; white-space: pre-wrap; margin-top: .75rem; }
    details { margin-top: 1rem; }
    a { color: inherit; text-decoration: underline; }
    @media (prefers-color-scheme: dark) {
      body { background: #0b1220; color: #e6e8ee; }
      .card { background: #111a2c; border-color: rgba(255,255,255,.12); }
      .meta { color: #aeb6c2; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Folkm√§ngd i Karlskoga</h1>
    <div id="value" class="value">H√§mtar‚Ä¶</div>
    <div id="meta" class="meta small"></div>

    <details>
      <summary>K√§lla & tekniska detaljer</summary>
      <div class="small" style="margin-top:.5rem; line-height:1.55;">
        Region: <strong>1883 (Karlskoga)</strong><br/>
        Tabell: <code>BE/BE0101/BE0101A/BefolkningNy</code><br/>
        Urval: K√∂n = 1+2 (totalt), √Ölder = totalt, Tid = senaste √•r<br/>
        Denna sida anropar en liten proxy (Apps Script) som i sin tur h√§mtar fr√•n SCB.<br/>
        Statistikdatabasen: <a href="https://www.statistikdatabasen.scb.se/" target="_blank" rel="noreferrer">SCB ‚Äì Statistikdatabasen</a>
      </div>
    </details>

    <div id="error" class="error" aria-live="polite"></div>
  </div>

  <script>
    // 1) Klistra in din Apps Script "Web app URL" h√§r:
    const PROXY_URL = "https://script.google.com/macros/s/AKfycbwWVf5T4d-JJwbX0alOhs9bCDZwGolqClKoRpztXBvZhcv8LhzfUl_jtS7wE2vICAM/exec";

    function fmtInt(x){ try { return new Intl.NumberFormat('sv-SE').format(x); } catch { return String(x); } }

    async function fetchViaProxy() {
      // Enkel GET utan headers ‚Üí ingen preflight ‚Üí brukar funka fint mot Apps Script
      const res = await fetch(PROXY_URL, { method: "GET", cache: "no-store" });
      if (!res.ok) throw new Error(`Proxy svarade ${res.status} ${res.statusText}`);
      return await res.json();
    }

    (async () => {
      const $value = document.getElementById('value');
      const $meta  = document.getElementById('meta');
      const $error = document.getElementById('error');

      try {
        const json = await fetchViaProxy();
        const row = json?.data?.[0];
        if (!row) throw new Error("Inget data returnerades fr√•n SCB.");

        const value = parseInt(row.values?.[0], 10);
        const year  = (row.key && row.key[row.key.length - 1]) || ""; // sista nyckeln √§r normalt Tid
        const updated = json?.updated || ""; // vissa tabeller har detta f√§lt

        if (!Number.isFinite(value)) throw new Error("V√§rdet kunde inte tolkas som heltal.");

        $value.textContent = `${fmtInt(value)} inv√•nare`;
        $meta.textContent = [
          year ? `Senaste √•r: ${year}` : null,
          updated ? `Uppdaterad: ${updated}` : null,
          "K√§lla: SCB (via proxy)"
        ].filter(Boolean).join(" ¬∑ ");
      } catch (err) {
        console.error(err);
        $value.textContent = "‚Äî";
        $error.textContent = String(err?.message || err);
      }
    })();
  </script>
</body>
</html>
